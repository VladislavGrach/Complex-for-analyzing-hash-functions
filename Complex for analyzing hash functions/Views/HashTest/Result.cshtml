@model Complex_for_analyzing_hash_functions.Models.HashTestResult
@using System.Text.Json;

@{
    ViewData["Title"] = "Результат тестирования";

    JsonElement raw;
    try
    {
        raw = JsonSerializer.Deserialize<JsonElement>(Model.BitFlipJson);
    }
    catch
    {
        raw = default;
    }

    var json = (raw.ValueKind != JsonValueKind.Undefined && raw.ValueKind != JsonValueKind.Null)
        ? Complex_for_analyzing_hash_functions.Helpers.JsonUtils.NormalizeToObject(raw)
        : default;
}

<div class="container py-4">
    <div class="d-flex align-items-baseline justify-content-between flex-wrap gap-2 mb-3">
        <div>
            <h2 class="h4 mb-1">Результаты тестирования</h2>
            <p class="text-muted small mb-0">Детальная статистика по выполненному запуску.</p>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <div class="row g-3 g-lg-4">

                <!-- BASIC -->
                <div class="col-12">
                    <div class="border rounded-3 bg-white p-3 hover-gray">
                        <h3 class="h6 mb-2">Basic</h3>
                        <div class="table-responsive">
                            <table class="table table-sm mb-0">
                                <tbody>
                                    <tr>
                                        <th class="text-nowrap" style="width: 220px;">Algorithm</th>
                                        <td style="white-space: pre-wrap;">@Model.Algorithm</td>
                                    </tr>
                                    <tr>
                                        <th class="text-nowrap">Rounds</th>
                                        <td style="white-space: pre-wrap;">@Model.Rounds</td>
                                    </tr>
                                    <tr>
                                        <th class="text-nowrap">TestsCount</th>
                                        <td style="white-space: pre-wrap;">@Model.TestsCount</td>
                                    </tr>
                                    <tr>
                                        <th class="text-nowrap">RunDate</th>
                                        <td style="white-space: pre-wrap;">@Model.RunDate</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                @if (json.ValueKind == JsonValueKind.Undefined || json.ValueKind == JsonValueKind.Null)
                {
                    <div class="col-12">
                        <div class="text-muted">Не удалось прочитать JSON статистики.</div>
                    </div>
                }
                else
                {
                    <!-- NIST -->
                    @if (json.TryGetProperty("NIST", out var nist) && nist.ValueKind == JsonValueKind.Object)
                    {
                        <div class="col-lg-6">
                            <div class="border rounded-3 bg-white p-3 h-100 hover-gray">
                                <h3 class="h6 mb-2">NIST</h3>
                                <ul class="list-group list-group-flush small">
                                    @foreach (var test in nist.EnumerateObject())
                                    {
                                        <li class="list-group-item d-flex justify-content-between gap-3 hover-gray">
                                            <span class="text-nowrap"><strong>@test.Name</strong></span>
                                            <span class="text-end" style="white-space: pre-wrap;">@test.Value</span>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                    }

                    <!-- DIEHARD -->
                    @if (json.TryGetProperty("Diehard", out var dh) && dh.ValueKind == JsonValueKind.Object)
                    {
                        <div class="col-lg-6">
                            <div class="border rounded-3 bg-white p-3 h-100 hover-gray">
                                <h3 class="h6 mb-2">Diehard</h3>
                                <ul class="list-group list-group-flush small">
                                    @foreach (var test in dh.EnumerateObject())
                                    {
                                        <li class="list-group-item d-flex justify-content-between gap-3 hover-gray">
                                            <span class="text-nowrap"><strong>@test.Name</strong></span>
                                            <span class="text-end" style="white-space: pre-wrap;">@test.Value</span>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                    }

                    <!-- TESTU01 -->
                    @if (json.TryGetProperty("TestU01", out var u01) && u01.ValueKind == JsonValueKind.Object)
                    {
                        <div class="col-lg-6">
                            <div class="border rounded-3 bg-white p-3 h-100 hover-gray">
                                <h3 class="h6 mb-2">TestU01</h3>
                                <ul class="list-group list-group-flush small">
                                    @foreach (var test in u01.EnumerateObject())
                                    {
                                        <li class="list-group-item d-flex justify-content-between gap-3 hover-gray">
                                            <span class="text-nowrap"><strong>@test.Name</strong></span>
                                            <span class="text-end" style="white-space: pre-wrap;">@test.Value</span>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                    }

                    <!-- AVALANCHE -->
                    @if (json.TryGetProperty("Avalanche", out var avalanche) && avalanche.ValueKind == JsonValueKind.Object)
                    {
                        <div class="col-lg-6">
                            <div class="border rounded-3 bg-white p-3 h-100 hover-gray">
                                <h3 class="h6 mb-2">Avalanche</h3>
                                <ul class="list-group list-group-flush small">
                                    @foreach (var test in avalanche.EnumerateObject())
                                    {
                                        <li class="list-group-item d-flex justify-content-between gap-3 hover-gray">
                                            <span class="text-nowrap"><strong>@test.Name</strong></span>
                                            <span class="text-end" style="white-space: pre-wrap;">@test.Value</span>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                    }

                    <!-- BIC -->
                    @if (json.TryGetProperty("BIC", out var bic) && bic.ValueKind == JsonValueKind.Object)
                    {
                        <div class="col-lg-6">
                            <div class="border rounded-3 bg-white p-3 h-100 hover-gray">
                                <h3 class="h6 mb-2">BIC</h3>
                                <ul class="list-group list-group-flush small">
                                    @foreach (var test in bic.EnumerateObject())
                                    {
                                        <li class="list-group-item d-flex justify-content-between gap-3 hover-gray">
                                            <span class="text-nowrap"><strong>@test.Name</strong></span>
                                            <span class="text-end" style="white-space: pre-wrap;">@test.Value</span>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                    }

                    <!-- Полный JSON -->
                    <div class="col-12">
                        <details class="border rounded-3 bg-white p-3 hover-gray">
                            <summary class="fw-semibold">Полный JSON</summary>
                            <pre class="mt-3 mb-0 small" style="white-space: pre-wrap;">@Model.BitFlipJson</pre>
                        </details>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
