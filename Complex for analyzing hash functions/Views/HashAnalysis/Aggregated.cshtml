@model List<Complex_for_analyzing_hash_functions.Models.RoundStatisticAggregatedPoint>

@{
    ViewData["Title"] = "Анализ по раундам";
    var suite = ViewBag.Suite as string ?? "diff";
}

<div class="mb-4">
    <h2 class="fw-semibold">Анализ свойств хэш-функции по числу раундов</h2>

    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <form method="get" id="algorithmForm" class="row g-2 align-items-center">
            <input type="hidden" name="suite" id="suiteHidden" value="" />

            <div class="col-auto">
                <label class="col-form-label">Алгоритм:</label>
            </div>

            <div class="col-auto">
                <select name="algorithm" class="form-select" onchange="this.form.submit()">
                    <!option value="Keccak"  @(ViewBag.Algorithm == "Keccak" ? "selected" : null)>Keccak</!option>
                    <!option value="Blake"   @(ViewBag.Algorithm == "Blake" ? "selected" : null)>BLAKE-256</!option>
                    <!option value="Blake2s" @(ViewBag.Algorithm == "Blake2s" ? "selected" : null)>BLAKE2s</!option>
                    <!option value="Blake2b" @(ViewBag.Algorithm == "Blake2b" ? "selected" : null)>BLAKE2b</!option>
                    <!option value="Blake3"  @(ViewBag.Algorithm == "Blake3" ? "selected" : null)>BLAKE3</!option>
                </select>
            </div>
        </form>

    </div>
</div>

<!-- ===== ВКЛАДКИ ===== -->
<div class="mb-4">
    <label class="form-label fw-semibold">Группа тестов:</label><br />

    <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="suiteRadio" id="suite-diff" value="diff"
        @((string.IsNullOrWhiteSpace(Context.Request.Query["suite"]) || Context.Request.Query["suite"] == "diff")
            ? "checked" : null)>
        <label class="form-check-label" for="suite-diff">SAC / BIC</label>
    </div>

    <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="suiteRadio" id="suite-nist" value="nist"
        @(Context.Request.Query["suite"] == "nist" ? "checked" : null)>
        <label class="form-check-label" for="suite-nist">NIST</label>
    </div>

    <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="suiteRadio" id="suite-diehard" value="diehard"
        @(Context.Request.Query["suite"] == "diehard" ? "checked" : null)>
        <label class="form-check-label" for="suite-diehard">Diehard</label>
    </div>

    <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="suiteRadio" id="suite-testu01" value="testu01"
        @(Context.Request.Query["suite"] == "testu01" ? "checked" : null)>
        <label class="form-check-label" for="suite-testu01">TestU01</label>
    </div>
</div>


<!-- ===== SAC + BIC ===== -->
<div class="suite-group" data-suite="diff">
    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Avalanche Effect</h5>
                    <canvas id="sacChart" height="140"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Bit Independence Criterion</h5>
                    <canvas id="bicChart" height="140"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ===== NIST ===== -->
<div class="suite-group d-none" data-suite="nist">
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title">NIST Statistical Test Suite</h5>
            <canvas id="monobitChart" height="140"></canvas>
        </div>
    </div>
</div>

<!-- Заглушки под будущие батареи -->
<div class="suite-group d-none" data-suite="diehard">
    <div class="alert alert-secondary">Графики Diehard будут добавлены сюда</div>
</div>

<div class="suite-group d-none" data-suite="testu01">
    <div class="alert alert-secondary">Графики TestU01 будут добавлены сюда</div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        window.hashAnalysisData = {
            rounds: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Select(x => x.Rounds))),
            metrics: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(
            Model.Select(x => x.Metrics)
        ))
        };
    </script>

    <script src="~/js/hash-analysis.js"></script>
}