@model List<Complex_for_analyzing_hash_functions.Models.RoundStatisticAggregatedPoint>

@{
    ViewData["Title"] = "Анализ по раундам";
}

<div class="mb-4">
    <h2 class="fw-semibold">Анализ свойств хэш-функции по числу раундов</h2>
    <p class="text-muted mb-3">
        Визуализация изменения статистических характеристик при варьировании числа раундов.
    </p>

    <form method="get" class="row g-2 align-items-center">
        <div class="col-auto">
            <label class="col-form-label">Алгоритм:</label>
        </div>
        <div class="col-auto">
            <select name="algorithm" class="form-select" onchange="this.form.submit()">
                <option value="Keccak" selected="@(ViewBag.Algorithm == "Keccak")">Keccak</option>
                <option value="Blake" selected="@(ViewBag.Algorithm == "Blake")">BLAKE-256</option>
                <option value="Blake2s" selected="@(ViewBag.Algorithm == "Blake2s")">BLAKE2s</option>
                <option value="Blake2b" selected="@(ViewBag.Algorithm == "Blake2b")">BLAKE2b</option>
                <option value="Blake3" selected="@(ViewBag.Algorithm == "Blake3")">BLAKE3</option>
            </select>

        </div>
    </form>
</div>

<div class="row g-4">

    <!-- Avalanche -->
    <div class="col-lg-6">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Avalanche Effect</h5>
                <canvas id="sacChart" height="140"></canvas>
            </div>
        </div>
    </div>

    <!-- BIC -->
    <div class="col-lg-6">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Bit Independence Criterion</h5>
                <canvas id="bicChart" height="140"></canvas>
            </div>
        </div>
    </div>

    <!-- Hamming -->
    <div class="col-lg-12">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Среднее расстояние Хэмминга</h5>
                <canvas id="hammingChart" height="140"></canvas>
            </div>
        </div>
    </div>

</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        const rounds = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Select(x => x.Rounds)));

        // ===== SAC =====
        const sacMean  = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Select(x => x.MeanFlipRateMean)));
        const sacCi    = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Select(x => x.MeanFlipRateCi)));
        const sacUpper = sacMean.map((m, i) => m + sacCi[i]);
        const sacLower = sacMean.map((m, i) => m - sacCi[i]);

        // ===== BIC =====
        const bicMean  = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Select(x => x.BicMaxCorrelationMean)));
        const bicCi    = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Select(x => x.BicMaxCorrelationCi)));
        const bicUpper = bicMean.map((m, i) => m + bicCi[i]);
        const bicLower = bicMean.map((m, i) => m - bicCi[i]);

        // ===== Hamming =====
        const hamMean  = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Select(x => x.AvgHammingMean)));
        const hamCi    = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Select(x => x.AvgHammingCi)));
        const hamUpper = hamMean.map((m, i) => m + hamCi[i]);
        const hamLower = hamMean.map((m, i) => m - hamCi[i]);
    </script>

    <script src="~/js/hash-analysis.js"></script>
}
